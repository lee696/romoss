<extend name="Public:base" />
<block name="main">
    <style>
        .order-box{}
        .order-box .top{
            height: 4rem;
            line-height: 4rem;
            background-color: #fff;
            border-bottom: 1px solid #f8f8f8;
            font-size: 1.5rem;
        }
        .order-box .top ul li{
            width:19%;
            display: inline-block;
            text-align: center;
        }
        .order-box .top ul li span{
            display: inline-block;
            height: 4rem;
        }
        .order-box .top ul li span.or-active{
            color:#31a9ff;
            border-bottom: 2px solid #31a9ff;
        }
        .order-box .or-col{
            height: 4.15rem;
            line-height: 4.15rem;
            background-color: #fff;
            border-bottom: 1px solid #f8f8f8;
            padding: 0 1.5rem;
            color:#c2c4c6;
            font-size: 1.4rem;
        }
        .order-box .or-title{
            margin-top: 1rem;
        }
        .order-box .or-title img{
            width: 1.8rem;
            height: 1.8rem;
            position: relative;
            top: .4rem;
            margin-right: 1rem;
        }
        .order-box .or-title span{
            float: right;
            color:#db8686;
        }
        .order-box .or-goods-info{
            padding: 1rem 1.5rem;
            height: 12rem;
            position: relative;
            color:#827070;
        }
        .order-box .or-goods-info img{
            width: 8rem;
            height: 10rem;
            background-color: #fff;
        }
        .order-box .or-goods-info p{
            position: absolute;
            font-size: 1.4rem;
            padding-right: 1.5rem;
            overflow:hidden;
        }
        .order-box .or-goods-info .or-goods-name{
            top: 1rem;
            height: 4.4rem;
            left: 10.5rem;
            line-height: 1.6;
        }
        .order-box .or-goods-info .or-goods-money{
            top: 7rem;
            left: 10.5rem;
            line-height: 1.6;
        }
        .order-box .or-goods-info .or-goods-num{
            top: 7rem;
            line-height: 1.6;
            left: none;
            right: 0;
        }
        .order-box .or-pay-money p{
            color:#000;
            float: right;
        }
        .order-box .or-pay-btn p{
            float: right;
        }
        .order-box .or-pay-btn a{
            display: inline-block;
            border: 1px solid #31a9ff;
            color:#31a9ff;
            width:8rem;
            height: 2.6rem;
            font-size: 1.3rem;
            line-height: 2.6rem;
            text-align: center;
            border-radius: 3rem;
            margin-left: .5rem;
        }
  #wrapper {
   position:absolute; z-index:1;
   top:7rem; bottom:0; left:0;
   width:100%;
   overflow:auto;
  }
 
  #scroller {
   position:relative;
  /* -webkit-touch-callout:none;*/
   -webkit-tap-highlight-color:rgba(0,0,0,0);
    top: 3.5rem;
   float:left;
   width:100%;
   padding:0;
  }
 
  #scroller ul {
   position:relative;
   list-style:none;
   padding:0;
   margin:0;
   width:100%;
   text-align:left;
  }
 
  #scroller li {
   padding:0 10px;
   height:40px;
   line-height:40px;
   border-bottom:1px solid #ccc;
   border-top:1px solid #fff;
   background-color:#fafafa;
   font-size:14px;
  }
 
  #scroller li > a {
   display:block;
  }
 
  /**
   *
   * 下拉样式 Pull down styles
   *
   */
  #pullDown, #pullUp {
   background:#fff;
   height:40px;
   line-height:40px;
   padding:5px 10px;
   border-bottom:1px solid #ccc;
   font-weight:bold;
   font-size:14px;
   color:#888;
   text-align: center;
  }
  #pullDown .pullDownIcon, #pullUp .pullUpIcon {
   display:block; float:left;
   width:40px; height:40px;
   background:url(pull-icon@2x.png) 0 0 no-repeat;
   -webkit-background-size:40px 80px; background-size:40px 80px;
   -webkit-transition-property:-webkit-transform;
   -webkit-transition-duration:250ms; 
  }
  #pullDown .pullDownIcon {
   -webkit-transform:rotate(0deg) translateZ(0);
  }
  #pullUp .pullUpIcon {
   -webkit-transform:rotate(-180deg) translateZ(0);
  }
 
 
  /**
   * 动画效果css3代码
   */
  #pullDown.flip .pullDownIcon {
   -webkit-transform:rotate(-180deg) translateZ(0);
  }
 
  #pullUp.flip .pullUpIcon {
   -webkit-transform:rotate(0deg) translateZ(0);
  }
 
  #pullDown.loading .pullDownIcon, #pullUp.loading .pullUpIcon {
   background-position:0 100%;
   -webkit-transform:rotate(0deg) translateZ(0);
   -webkit-transition-duration:0ms;
 
   -webkit-animation-name:loading;
   -webkit-animation-duration:2s;
   -webkit-animation-iteration-count:infinite;
   -webkit-animation-timing-function:linear;
  }
 
  @-webkit-keyframes loading {
   from { -webkit-transform:rotate(0deg) translateZ(0); }
   to { -webkit-transform:rotate(360deg) translateZ(0); }
  }
 
    </style>
    <div class="header-panel">
        <a href="{:U('Member/index')}" class="go-back"></a>我的订单
    </div>
    <div class="order-box" style='margin-top: 3.5rem'>
        <div class="top">
            <ul>
                <li><a href="{:U('Order/index?type=0')}"><span <if condition="$data.type eq 0"> class="or-active"</if>>全部</span></a></li>
                <li><a href="{:U('Order/index?type=1')}"><span <if condition="$data.type eq 1"> class="or-active"</if>>待付款</span></a></li>
                <li><a href="{:U('Order/index?type=2')}"><span <if condition="$data.type eq 2"> class="or-active"</if>>待收货</span></a></li>
                <li><a href="{:U('Order/index?type=4')}"><span <if condition="$data.type eq 4"> class="or-active"</if>>待评价</span></a></li>
                <li><a href="{:U('Order/index?type=6')}"><span <if condition="$data.type eq 6"> class="or-active"</if>>已完成</span></a></li>
            </ul>
        </div>
        <div id="wrapper">
            <div id="scroller">
            <foreach name="data.list" item="item" >
                    <div>
                        <div class="or-col or-title">
                            <img src="__WX_IMG__/logo.png"/>罗马仕
                            <span>
                                <switch name="item.status" >
                                <case value="1">等待买家付款</case>
                                <case value="2">已付款，等待发货</case>
                                <case value="3">已发货</case>
                                <case value="4">已收货</case>
                                <case value="5">已取消</case>
                                <case value="6">已完成</case>
                                <default />未知
                                </switch>
                            </span>
                        </div>
                        <!--<a href="{:U('Order/details', ['oid' => $item['order_id']])}">-->
                        <div id='od' onclick="detial({$item.order_id});">
                          
                       
                        <foreach name="item.goods_list" item="goods" >
                            <div class="or-goods-info">
                                <a href="{:U('Goods/index', ['goods_id' => $goods['goods_id']])}">
                                    <img src="{$goods.goods_img}"/>
                                </a>
                                <p class="or-goods-name">{$goods.goods_name}</p>
                                <p class="or-goods-money">￥{$goods.price}</p>
                                <p class="or-goods-num">×{$item.goods_num}</p>
                            </div>
                        </foreach>
                         </a>
                         </div>
                        <div class="or-col or-pay-money">
                            <p>
                                <span>共{$item.goods_num}件商品 需付款:</span>
                                <span style="color:#ed5f86"><b style="font-size:1.6rem;font-weight: normal">{$item.price}</b></span>
                                <span style="color:#c2c4c6">(含运费{$item.shipping_fee})</span>
                            </p>
                        </div>
                        <div class="or-col or-pay-btn" style="clear:both">
                            <p>
                              <switch name="item.status" >
                            <case value="1">
                              <a href="{:U('Order/cancel',array('oid'=>$item['order_id']))}">取消订单</a>
                                <a href="{:U('Order/pay',array('order_id'=>$item['order_id']))}">付款</a>
                                
                            </case>
                                <case value="2"></case>
                                <case value="3"><a href="{:U('Order/confirm',array('oid'=>$item['order_id']))}">确认收货</a></case>
                                <case value="4"><a href="{:U('Order/evaluate',array('oid'=>$item['order_id']))}">评价</a></case>
                                <case value="5"><a href="{:U('Order/del',['oid'=>$item['order_id']])}">删除订单</a></case>
                                <case value="6"><a href="{:U('Goods/index', ['goods_id' => $item['goods_id']])}">再次购买</a><a href="{:U('Order/del',array('oid'=>$item['order_id']))}">删除订单</a></case>
                                <default />未知
                                </switch>
                              
                            </p>
                        </div>
                    </div>
            </foreach>
            <div id="pullUp">
                <span class="pullUpIcon"></span><span class="pullUpLabel">上拉加载更多...</span>
            </div>
        </div>
    </div>
</block>
<block name="js-con">
    <script src="__AMAZEUI__/js/iscroll4.js"></script>
    <script>
       function detial(oid){
            location.href ="{:U('Order/details','',true,true)}?oid="+oid;
          }

        var myScroll,
         pullUpEl, pullUpOffset,
         generatedCount = 0;

        /**
         * 滚动翻页 （自定义实现此方法）
         * myScroll.refresh();  // 数据加载完成后，调用界面更新方法
         */
        function pullUpAction () {
            generatedCount++;
            console.log(generatedCount)
         setTimeout(function () { // <-- Simulate network congestion, remove setTimeout from production!
          myScroll.refresh();  // 数据加载完成后，调用界面更新方法 Remember to refresh when contents are loaded (ie: on ajax completion)
         }, 1000); // <-- Simulate network congestion, remove setTimeout from production!
        }
         
        /**
         * 初始化iScroll控件
         */
        function loaded() {
         pullUpEl = document.getElementById('pullUp'); 
         pullUpOffset = pullUpEl.offsetHeight;
         
         myScroll = new iScroll('wrapper', {
          // scrollbarClass: 'myScrollbar', /* 重要样式 */
          useTransition: false, /* 此属性不知用意，本人从true改为false */
          topOffset: pullUpOffset,
          onRefresh: function () {
           if (pullUpEl.className.match('loading')) {
            pullUpEl.className = '';
            pullUpEl.querySelector('.pullUpLabel').innerHTML = '上拉加载更多...';
           }
          },
          onScrollMove: function () {
           if (this.y < (this.maxScrollY - 5) && !pullUpEl.className.match('flip')) {
            pullUpEl.className = 'flip';
            pullUpEl.querySelector('.pullUpLabel').innerHTML = '松手开始更新...';
            this.maxScrollY = this.maxScrollY;
           } else if (this.y > (this.maxScrollY + 5) && pullUpEl.className.match('flip')) {
            pullUpEl.className = '';
            pullUpEl.querySelector('.pullUpLabel').innerHTML = '上拉加载更多...';
            this.maxScrollY = pullUpOffset;
           }
          },
          onScrollEnd: function () {
           if (pullUpEl.className.match('flip')) {
            pullUpEl.className = 'loading';
            pullUpEl.querySelector('.pullUpLabel').innerHTML = '加载中...';    
            pullUpAction(); // Execute custom function (ajax call?)
           }
          }
         });
         
         // setTimeout(function () { document.getElementById('wrapper').style.left = '0'; }, 800);
        }
         
        //初始化绑定iScroll控件 
        document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
        document.addEventListener('DOMContentLoaded', loaded, false);

    </script>
</block>